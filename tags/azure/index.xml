<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Azure on Frank's Notes</title><link>https://blog.yylin.io/tags/azure/</link><description>Recent content in Azure on Frank's Notes</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><lastBuildDate>Sun, 13 Mar 2022 21:40:40 +0800</lastBuildDate><atom:link href="https://blog.yylin.io/tags/azure/index.xml" rel="self" type="application/rss+xml"/><item><title>從零開始快速建置 - Microsoft Azure Red Hat OpenShift (ARO)</title><link>https://blog.yylin.io/openshift/aro/</link><pubDate>Sun, 13 Mar 2022 21:40:40 +0800</pubDate><guid>https://blog.yylin.io/openshift/aro/</guid><description>&lt;p>ARO4 深入探討 - Microsoft Azure Red Hat OpenShift 4&lt;/p>
&lt;p>讓我們深入挖掘！&lt;/p>
&lt;p>Microsoft Azure Red Hat OpenShift 服務支持部署完全託管的 OpenShift 集群。&lt;/p>
&lt;p>Azure Red Hat OpenShift 由 Red Hat 和 Microsoft 聯合設計、運營和支持，以提供集成的支持體驗。沒有虛擬機可以運行，也不需要打補丁。主節點、基礎架構和應用程序節點由 Red Hat 和 Microsoft 代表您進行修補、更新和監控。您的 Azure Red Hat OpenShift 集群已部署到您的 Azure 訂閱中，並包含在您的 Azure 賬單中。&lt;/p>
&lt;p>在 OpenShift 4 上部署 Azure Red Hat 時，整個集群都包含在一個虛擬網絡中。在這個虛擬網絡中，您的主節點和工作節點都位於各自的子網中。每個子網都使用一個內部負載均衡器和一個公共負載均衡器。&lt;/p>
&lt;p>這是有關 Azure Red Hat OpenShift 4 的官方圖表（可在 ARO4 Microsoft 頁面中找到）：&lt;/p>
&lt;p>&lt;img src="https://rcarrata.com/images/aro4-networking-diagram.png"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>關於 ARO4 部署和管理的網絡和資源的更多詳細信息，請查看&lt;a class="link" href="https://docs.microsoft.com/en-us/azure/openshift/concepts-networking#networking-components" target="_blank" rel="noopener"
>ARO 圖詳細信息 - 官方文檔&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>讓我們安裝我們的第一個 ARO4 集群！&lt;/p>
&lt;h2 id="azure-帳戶先決條件">Azure 帳戶先決條件
&lt;/h2>&lt;p>首先，我們需要在 Azure 帳戶中設置幾項內容，例如生成 ServicePrincipals、增加限制以及定義要使用的區域。&lt;/p>
&lt;ul>
&lt;li>按照&lt;a class="link" href="https://docs.openshift.com/container-platform/latest/installing/installing_azure/installing-azure-account.html" target="_blank" rel="noopener"
>配置 Azure 帳戶先決條件&lt;/a>來定義和分配適當的 RBAC 權限並增加對 Azure 帳戶的限制。&lt;/li>
&lt;/ul>
&lt;h2 id="為-aro-安裝配置-azure-基礎結構先決條件">為 ARO 安裝配置 Azure 基礎結構先決條件
&lt;/h2>&lt;p>當我們準備好上一步後，就可以在 Azure 中為我們的 ARO4 集群生成基礎資源先決條件了：&lt;/p>
&lt;ul>
&lt;li>定義 ARO4 安裝的基本參數：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">LOCATION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">eastus&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">RESOURCEGROUP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">aro&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">rg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">CLUSTER&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">rcarrata&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">VNET_CIDR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;10.0.0.0/22&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">MASTER_SUBNET_CIDR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;10.0.0.0/23&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">WORKER_SUBNET_CIDR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;10.0.2.0/23&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>使用 az cli 登錄到 Azure：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">az login
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意：當登錄彈出時，您需要在 Azure Dashboard 中使用您的憑據進行身份驗證。&lt;/p>
&lt;ul>
&lt;li>註冊資源提供者：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">az provider register -n Microsoft.RedHatOpenShift --wait
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az provider register -n Microsoft.Compute --wait
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az provider register -n Microsoft.Storage --wait
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="建立-azure-red-hat-openshift-4-叢集">建立 Azure Red Hat OpenShift 4 叢集
&lt;/h1>&lt;h2 id="開始之前">開始之前
&lt;/h2>&lt;p>Azure Red Hat OpenShift 至少需要 40 個核心，才能建立和執行 OpenShift 叢集。 新 Azure 訂用帳戶的預設 Azure 資源配額不符合這項需求。 若要要求增加資源限制，請參閱標準配額：&lt;a class="link" href="https://docs.microsoft.com/zh-tw/azure/azure-portal/supportability/per-vm-quota-requests" target="_blank" rel="noopener"
>VM 系列的增加限制&lt;/a>。&lt;/p>
&lt;ul>
&lt;li>例如，若要檢查最小支援的虛擬機器系列 SKU 「標準 DSv3」的目前訂用帳戶配額：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">LOCATION=eastus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az vm list-usage -l $LOCATION \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--query &amp;#34;[?contains(name.value, &amp;#39;standardDSv3Family&amp;#39;)]&amp;#34; \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-o table
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">CurrentValue Limit LocalName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------- ------- --------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">40 1000 Standard DSv3 Family vCPUs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="驗證權限">驗證權限
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Azure&lt;/span> &lt;span class="n">CLI&lt;/span> &lt;span class="n">quickstart&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">GUID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">hzdnk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">CLIENT_ID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">bdf5480a&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">c661&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">451&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">a2ce&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">81e448&lt;/span>&lt;span class="n">ce0ba8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">Zz842xzC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">GWZS_xVZ3oQvg1&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="n">PtoIcKVA&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">TENANT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="n">ce7852f&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dcf3&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="n">bc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">afe6&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="n">bf81ab984fb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">SUBSCRIPTION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">ede7f891&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">835&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4128&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">af5b&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">0e53848&lt;/span>&lt;span class="n">e54e7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">export&lt;/span> &lt;span class="n">RESOURCEGROUP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">openenv&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hzdnk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">curl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">L&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">aka&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">InstallAzureCli&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">bash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">az&lt;/span> &lt;span class="n">login&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">principal&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">u&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">CLIENT_ID&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">PASSWORD&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">tenant&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">TENANT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;cloudName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;AzureCloud&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;homeTenantId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1ce7852f-dcf3-42bc-afe6-3bf81ab984fb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;ede7f891-835c-4128-af5b-0e53848e54e7&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;isDefault&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;managedByTenants&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;tenantId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;b5ce0030-ec42-4a62-bc94-3025993e790c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;RHPDS Subscription - OpenTLC Tenant&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;state&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Enabled&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;tenantId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1ce7852f-dcf3-42bc-afe6-3bf81ab984fb&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;user&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;bdf5480a-c661-451f-a2ce-81e448ce0ba8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;servicePrincipal&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>創建資源組為 ARO4 對象（如 vnet 和子網，以及自己的 ARO4 對象）分配資源：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">az group create --name $RESOURCEGROUP --location $LOCATION
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>創建虛擬網絡：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">az network vnet create --resource-group $RESOURCEGROUP \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name aro-vnet --address-prefixes $VNET_CIDR
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>為主節點添加一個空子網：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">az network vnet subnet create \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --resource-group $RESOURCEGROUP \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --vnet-name aro-vnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name master-subnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --address-prefixes $MASTER_SUBNET_CIDR \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --service-endpoints Microsoft.ContainerRegistry
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>為工作節點添加一個空子網：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">az network vnet subnet create \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --resource-group $RESOURCEGROUP \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --vnet-name aro-vnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name worker-subnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --address-prefixes $WORKER_SUBNET_CIDR \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --service-endpoints Microsoft.ContainerRegistry
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>在主子網上禁用子網專用終結點策略：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">az network vnet subnet update \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name master-subnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --resource-group $RESOURCEGROUP \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --vnet-name aro-vnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --disable-private-link-service-network-policies true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安裝-aro4">安裝 ARO4
&lt;/h2>&lt;ul>
&lt;li>使用 azure cli 創建 ARO 集群：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;Creating ARO Cluster... Please wait 40mins&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az aro create --resource-group $RESOURCEGROUP \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name $CLUSTER --vnet aro-vnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --master-subnet master-subnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --worker-subnet worker-subnet \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --pull-secret @pull-secret.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意：安裝需要一個有效的 pull-secret。請訪問您的&lt;a class="link" href="https://rcarrata.com/openshift/aro4/cloud.redhat.com/openshift/" target="_blank" rel="noopener"
>Cloud OpenShift Doshboard&lt;/a>並獲取您的 pull-secret 令牌。&lt;/p>
&lt;ul>
&lt;li>然後 az aro cli 將在 Azure Dashboard 中預配一個 ARO 對象：&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://i.imgur.com/I1PyWMK.png"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>自動地，它使用用於安裝的 Azure 對象創建了一個額外的 Azure 資源組，由 RH 和 MSFT 的 ARO SRE 管理：&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://i.imgur.com/wjJ4OUi.png"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>在此資源組中，我們生成了提供和配置 ARO4 集群所需的資源：&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://rcarrata.com/images/aro4_3.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="訪問-api-和控制台">訪問 API 和控制台
&lt;/h2>&lt;ul>
&lt;li>大約 40 分鐘後。我們將使用控制台和 API 準備好 ARO4 集群：&lt;/li>
&lt;/ul>
&lt;p>&lt;a class="link" href="https://rcarrata.com/images/aro4_4.png" target="_blank" rel="noopener"
>&lt;/a>&lt;/p>
&lt;ul>
&lt;li>要訪問集群，請列出集群的憑據：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;List credentials for ARO Cluster&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az aro list-credentials \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name $CLUSTER \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --resource-group $RESOURCEGROUP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>要顯示 ARO4 控制台：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;List console for ARO cluster&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az aro show \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --name $CLUSTER \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --resource-group $RESOURCEGROUP \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --query &amp;#34;consoleProfile.url&amp;#34; -o tsv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>檢查 ARO4 API：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">apiServer=$(az aro show -g $RESOURCEGROUP -n $CLUSTER --query apiserverProfile.url -o tsv)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;This is the API for your cluster: $apiServer&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>查詢 ARO Cluster 狀態&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@bastion ~]# az aro list -o table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name ResourceGroup Location ProvisioningState WorkerCount URL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------- --------------- ---------- ------------------- ------------- -----------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">aro-demo openenv-hdpnp eastus Succeeded 3 https://console-openshift-console.apps.yylin.io/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>