<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>OCP 4.x on Frank's Notes</title><link>https://blog.yylin.io/tags/ocp-4.x/</link><description>Recent content in OCP 4.x on Frank's Notes</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><lastBuildDate>Sun, 26 Sep 2021 14:54:40 +0800</lastBuildDate><atom:link href="https://blog.yylin.io/tags/ocp-4.x/index.xml" rel="self" type="application/rss+xml"/><item><title>OpenShift 4.8.x UPI install on Bare metal</title><link>https://blog.yylin.io/openshift/ocp4-install/</link><pubDate>Sun, 26 Sep 2021 14:54:40 +0800</pubDate><guid>https://blog.yylin.io/openshift/ocp4-install/</guid><description>&lt;blockquote>
&lt;p>[註記] 由於硬體環境資源有限，本實驗是透過 &lt;a class="link" href="https://pve.proxmox.com/wiki/Main_Page" target="_blank" rel="noopener"
>&lt;code>Proxmox Environment&lt;/code>&lt;/a> 單一伺服器節點來模擬部署 &lt;code>OpenShift&lt;/code> 叢集，並依據官網配置建議硬體需求(Server sizing)資源。
[共同撰寫編輯]: &lt;a class="link" href="https://k2r2bai.com/" target="_blank" rel="noopener"
>Kyle Bai&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="部署版本說明">部署版本說明：
&lt;/h2>&lt;ul>
&lt;li>Proxmox Environment v6.1-7
&lt;ul>
&lt;li>CPU: 8-Core, 16-Thread Unlocked / Memory: 128 GB&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>OpenShift v4.8.x.&lt;/li>
&lt;/ul>
&lt;h2 id="reference">Reference
&lt;/h2>&lt;ul>
&lt;li>參考官網文件 - &lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/installing/installing_bare_metal/installing-bare-metal.html" target="_blank" rel="noopener"
>Installing a user-provisioned cluster on bare metal&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="事前準備">事前準備
&lt;/h2>&lt;p>開始前，需要先準備以下資訊與要求。&lt;/p>
&lt;h3 id="download-urls">Download URLs
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://console.redhat.com/openshift/install/metal/user-provisioned" target="_blank" rel="noopener"
>User-provisioned infrastructure&lt;/a>: 可下載 OpenShift Installer、CLI 與 Pull secrets(需要登入 Red Hat 註冊帳號權限)&lt;/li>
&lt;li>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest-4.8/" target="_blank" rel="noopener"
>Public OpenShift 4.8 Mirror&lt;/a>: 可下載 OpenShift Installer、CLI 與 OPM。
&lt;ul>
&lt;li>&lt;strong>openshift-client-linux.tar.gz&lt;/strong>: 包含 oc 與 kubectl CLI 工具。&lt;/li>
&lt;li>&lt;strong>openshift-install-linux.tar.gz&lt;/strong>: 包含 openshift-install 工具。用於建立 OpenShift auth、igntion 等設定檔案。&lt;/li>
&lt;li>&lt;strong>opm-linux.tar.gz&lt;/strong>: 用於管理 Operator Hub 與 mirror 相關 images。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.8/latest/" target="_blank" rel="noopener"
>Public RHCOS 4.8 Mirror&lt;/a>: 可下載 RHCOS 4.8 相關 VM images。
&lt;ul>
&lt;li>若手動安裝以下載 &lt;code>rhcos-live.x86_64.iso&lt;/code> 為主。若想要控管使用版本，請選擇有標示版本的 live iso。
&lt;ul>
&lt;li>FET vSphere 安裝請以這方式進行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>若以 PXE 方式安裝，則下載以下映像檔:
&lt;ul>
&lt;li>rhcos-live-initramfs.x86_64.img&lt;/li>
&lt;li>rhcos-live-kernel-x86_64&lt;/li>
&lt;li>rhcos-live-rootfs.x86_64.img&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>過程中會透過 &lt;code>wget&lt;/code> 下載，因此在有網路狀況下，不需要預先下載。&lt;/p>&lt;/blockquote>
&lt;hr>
&lt;h3 id="network-and-hosts-info">Network and Hosts Info
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>OpenShift subnet CIDR&lt;/strong>: 192.168.101.0/24&lt;/li>
&lt;li>&lt;strong>OpenShift Pod Network(CNI)&lt;/strong>: 10.128.0.0/14&lt;/li>
&lt;li>&lt;strong>OpenShift Service Network&lt;/strong>: 172.3.0.0/16&lt;/li>
&lt;li>&lt;strong>Domain&lt;/strong>: lab.yiylin.internal&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Hosts&lt;/th>
&lt;th>IP&lt;/th>
&lt;th>CPU&lt;/th>
&lt;th>RAM&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>bashtion&lt;/td>
&lt;td>192.168.101.9&lt;/td>
&lt;td>2 vCore&lt;/td>
&lt;td>4G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>bootstrap&lt;/td>
&lt;td>192.168.101.10&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>master-1&lt;/td>
&lt;td>192.168.101.21&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>master-2&lt;/td>
&lt;td>192.168.191.22&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>master-3&lt;/td>
&lt;td>192.168.191.23&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>worker-1&lt;/td>
&lt;td>192.168.191.31&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>worker-2&lt;/td>
&lt;td>192.168.191.32&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>infra-1&lt;/td>
&lt;td>192.168.191.41&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>infra-2&lt;/td>
&lt;td>192.168.191.42&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>infra-3&lt;/td>
&lt;td>192.168.191.43&lt;/td>
&lt;td>4 vCore&lt;/td>
&lt;td>8G&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;blockquote>
&lt;p>這裡為了方便測試，將 PXE / HAProxy / DNS Server 等都放在 bastion上。
[額外參考資訊]各元件節點最小資源可參考 &lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/installing/installing_platform_agnostic/installing-platform-agnostic.html#minimum-resource-requirements_installing-platform-agnostic" target="_blank" rel="noopener"
>Minimum resource requirements&lt;/a>。
請先透過 &lt;code>Proxmox Environment&lt;/code> 開啟對應 &lt;code>hardware&lt;/code> VM。&lt;/p>&lt;/blockquote>
&lt;h4 id="補充-network-說明">補充 Network 說明
&lt;/h4>&lt;blockquote>
&lt;p>其中 &lt;code>OpenShift subnet CIDR&lt;/code> 請修改為自己當前 Proxmox Environment 網路配置)
&lt;img src="https://i.imgur.com/8UnOcXL.jpg"
loading="lazy"
>&lt;/p>&lt;/blockquote>
&lt;h2 id="bastion">Bastion
&lt;/h2>&lt;p>透過 Live CD 安裝 RHEL 8 版本(或使用 CentOS 8)，並確保網路設定正確。&lt;/p>
&lt;blockquote>
&lt;p>RHEL 需要確認 &lt;code>subscription&lt;/code> 驗證，確保 repo 源可正常取得&lt;/p>&lt;/blockquote>
&lt;h3 id="事前準備-1">事前準備
&lt;/h3>&lt;p>進入 &lt;code>bastion&lt;/code> 機器，安裝 jq 與 wget 工具等:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ sudo su -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ yum install -y wget jq vim
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>關閉 bastion 防火牆:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ systemctl stop firewalld
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ systemctl disable firewalld
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;gt; 這邊方便測試，所以直接關閉 :D。&lt;/p>
&lt;p>設定與關閉 SELinux:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ vim /etc/selinux/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SELINUX&lt;/span>&lt;span class="o">=&lt;/span>disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ setenforce &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>這邊方便測試實驗，所以直接關閉。&lt;/p>&lt;/blockquote>
&lt;p>建立 SSH Keys:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ ssh-keygen -t rsa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>這邊方便測試，以 root 來建立。&lt;/p>&lt;/blockquote>
&lt;p>導入以下環境變數:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">DOMAIN&lt;/span>&lt;span class="o">=&lt;/span>lab.yiylin.internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">OCP_NETWORK_CIDR&lt;/span>&lt;span class="o">=&lt;/span>192.168.101.0/24
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下載 OpenShift Installer 與 CLI 工具，並解壓縮檔案到 &lt;code>/usr/local/bin/&lt;/code> 底下:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># CLI&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget -c https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest-4.8/openshift-client-linux.tar.gz -O - &lt;span class="p">|&lt;/span> tar -xz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ mv &lt;span class="o">{&lt;/span>oc,kubectl&lt;span class="o">}&lt;/span> /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Client Version: 4.8.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Installer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ wget -c https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest-4.8/openshift-install-linux.tar.gz -O - &lt;span class="p">|&lt;/span> tar -xz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ mv openshift-install /usr/local/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ openshift-install version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openshift-install 4.8.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="安裝與設定-dns-server">安裝與設定 DNS Server
&lt;/h3>&lt;p>安裝 DNS server 套件，這邊使用 &lt;code>dnsmasq&lt;/code> 來提供服務:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ yum -y install dnsmasq bind-utils
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>這部分也可參考 OCP 官網安裝 &lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/installing/installing_bare_metal/installing-bare-metal.html#installation-dns-user-infra-example_installing-bare-metal" target="_blank" rel="noopener"
>BIND&lt;/a>，關於不同 &lt;code>DNS Server&lt;/code> 相關配置方法，會額外補充於後續文章介紹。&lt;/p>&lt;/blockquote>
&lt;p>編輯 &lt;code>/etc/dnsmasq.d/openshift.conf&lt;/code> 設定檔，以設定 A Record 與 PTR:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat &amp;lt;&amp;lt; &lt;span class="s2">&amp;#34;EOF&amp;#34;&lt;/span> &amp;gt; /etc/dnsmasq.d/openshift.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">server&lt;/span>&lt;span class="o">=&lt;/span>8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">domain&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,&lt;span class="si">${&lt;/span>&lt;span class="nv">OCP_NETWORK_CIDR&lt;/span>&lt;span class="si">}&lt;/span>,local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A Records(api)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>api.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>, 192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>api-int.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>api-int.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A Records(hosts)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>bastion.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>bootstrap.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>master-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>master-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>master-3.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>worker-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.31
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>worker-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>infra-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>infra-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>infra-3.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.43
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># A Records(etcd)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>etcd-0.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>etcd-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">host-record&lt;span class="o">=&lt;/span>etcd-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,192.168.101.23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srv-host&lt;span class="o">=&lt;/span>_etcd-server-ssl._tcp.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,etcd-0.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,2380,0,10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srv-host&lt;span class="o">=&lt;/span>_etcd-server-ssl._tcp.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,etcd-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,2380,0,10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srv-host&lt;span class="o">=&lt;/span>_etcd-server-ssl._tcp.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,etcd-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>,2380,0,10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># PTRs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/apps.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/.apps.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/api.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/api-int.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/bastion.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/bootstrap.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/master-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/master-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/master-3.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/etcd-0.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/etcd-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/etcd-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/worker-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.31
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/worker-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/infra-1.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/infra-2.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>/infra-3.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>/192.168.101.43
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>啟動 dnsmasq 服務，並檢測 dnsmasq 設定是否正確:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ systemctl &lt;span class="nb">enable&lt;/span> dnsmasq&lt;span class="p">;&lt;/span> systemctl start dnsmasq
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ dnsmasq --test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dnsmasq: syntax check OK.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>編輯 &lt;code>/etc/resolv.conf&lt;/code> 檔案，修改 nameserver:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat &amp;lt;&amp;lt; &lt;span class="s2">&amp;#34;EOF&amp;#34;&lt;/span> &amp;gt; /etc/resolv.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nameserver 127.0.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>驗證 DNS server 正反解:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dig domain @dns_server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ dig bastion.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span> @192.168.101.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># dig -x ip @dns_server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ dig -x 192.168.101.9 @192.168.101.9
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>請驗證填寫自己對應的 &lt;code>ip address&lt;/code>&lt;/p>&lt;/blockquote>
&lt;h3 id="安裝與設定-http-server">安裝與設定 HTTP Server
&lt;/h3>&lt;p>安裝與設定 httpd 套件:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ yum -y install httpd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>編輯 &lt;code>/etc/httpd/conf/httpd.conf&lt;/code> 設定檔:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#Listen 12.34.56.78:80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Listen 8080
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>因為 80 是 Ingress-http 使用，除非將 HAProxy 拆成不同節點或用 External LB。&lt;/p>&lt;/blockquote>
&lt;p>啟動 httpd 服務:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ systemctl &lt;span class="nb">enable&lt;/span> httpd&lt;span class="p">;&lt;/span> systemctl start httpd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="產生-openshift-ignition-fils">產生 OpenShift Ignition fils
&lt;/h3>&lt;p>建立放置 OpenShift Config 檔案的目錄:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">cd&lt;/span> &lt;span class="nv">$HOME&lt;/span> &lt;span class="p">;&lt;/span> mkdir &lt;span class="nv">$HOME&lt;/span>/ocp4/ignition&lt;span class="p">;&lt;/span>&lt;span class="nb">cd&lt;/span> &lt;span class="nv">$HOME&lt;/span>/ocp4/ignition
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建立與編輯 &lt;code>install-config.yaml&lt;/code> 檔案:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">baseDomain&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">yiylin.internal&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">compute&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">hyperthreading&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Enabled&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">worker&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">controlPlane&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hyperthreading&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Enabled&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">lab&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">networking&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">clusterNetworks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">cidr&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">10.128.0.0&lt;/span>&lt;span class="l">/14&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hostPrefix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">24&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">networkType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">OpenShiftSDN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">serviceNetwork&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">172.3.0.0&lt;/span>&lt;span class="l">/16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">platform&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">none&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">pullSecret&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;{&amp;#34;auths&amp;#34;:{ YOUR_PULL_SECRETE }}&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">sshKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;SSH_PUB_KEY&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;ul>
&lt;li>Pull secret 可在 &lt;a class="link" href="https://cloud.redhat.com/openshift/install/metal/user-provisioned" target="_blank" rel="noopener"
>Create Cluster by user provisioned&lt;/a> 取得。&lt;/li>
&lt;li>Proxy 設定，參考 &lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/installing/installing_bare_metal/installing-restricted-networks-bare-metal.html#installation-configure-proxy_installing-restricted-networks-bare-metal" target="_blank" rel="noopener"
>Configuring the cluster-wide proxy during installation&lt;/a>。&lt;/li>
&lt;li>SSH Key 請自行於 &lt;code>bastion&lt;/code> 創建填寫，這裡不多做說明&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;p>產生 manifests 相關檔案:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cp install-config.yaml install-config.yaml.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ openshift-install create manifests --dir&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ls &lt;span class="nv">$HOME&lt;/span>/ocp4/ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">manifests openshift
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>編輯 &lt;code>manifests/cluster-scheduler-02-config.yml&lt;/code> 檔案，設定 &lt;code>mastersSchedulable&lt;/code> 值，以確保 master 不作為工作負載節點:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mastersSchedulable&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>產生 OCP 使用的 Ignition files:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ openshift-install create ignition-configs --dir&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ls &lt;span class="nv">$HOME&lt;/span>/ocp4/ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">auth bootstrap.ign master.ign metadata.json worker.ign
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>撰寫方面安裝 RHCOS 的腳本 &lt;code>$HOME/ocp4/ignition/coreos-install.sh&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> -eu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">DEVICE_NAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">DEVICE_NAME&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="p">/dev/sda&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">IGNITION_FILE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">IGNITION_FILE&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="nv">bootstrap&lt;/span>&lt;span class="p">.ign&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="c1"># bootstrap.ign master.ign worker.ign &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">IGNITION_URL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">IGNITION_URL&lt;/span>&lt;span class="k">:-&lt;/span>&lt;span class="nv">http&lt;/span>&lt;span class="p">://192.168.101.9:&lt;/span>&lt;span class="nv">8080&lt;/span>&lt;span class="p">/ignition/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">IGNITION_FILE&lt;/span>&lt;span class="si">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo coreos-installer install &lt;span class="si">${&lt;/span>&lt;span class="nv">DEVICE_NAME&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --insecure-ignition &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --ignition-url&lt;span class="o">=&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">IGNITION_URL&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --firstboot-args rd.neednet&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --copy-network
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>複製 &lt;code>*.ign&lt;/code> 與腳本 到 &lt;code>/var/www/html/ignition&lt;/code> 目錄:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ mkdir /var/www/html/ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cp -rp &lt;span class="nv">$HOME&lt;/span>/ocp4/ignition/&lt;span class="o">{&lt;/span>*.ign,coreos-install.sh&lt;span class="o">}&lt;/span> /var/www/html/ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ls /var/www/html/ignition
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bootstrap.ign master.ign worker.ign coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ chmod &lt;span class="m">664&lt;/span> -R /var/www/html/ignition/*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="bootstrap">Bootstrap
&lt;/h2>&lt;p>透過 PVE 建立 Bootstrap 節點，並掛載 RHCOS Live ISO，並進入 Console 執行以下操作。&lt;/p>
&lt;p>首先進入系統後，先設定 Network 資訊:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ sudo nmtui
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>設定網卡資訊:&lt;/p>
&lt;p>&lt;img src="https://i.imgur.com/tJFSkiO.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://i.imgur.com/vAEtA2f.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://i.imgur.com/qINQqLa.png"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>確保網卡 IP address 設定為 &lt;code>xx.xx.xx.xx/24&lt;/code>，若沒有設定 Network mask 的話，就會用預設 &lt;code>xx.xx.xx.xx/8&lt;/code>。&lt;/p>&lt;/blockquote>
&lt;p>重新啟動網卡設定:&lt;/p>
&lt;p>&lt;img src="https://i.imgur.com/KMvs0UZ.png"
loading="lazy"
>&lt;/p>
&lt;p>透過以下指令檢查設定結果:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ ip -4 a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>確認網路與 DNS 都能夠被解析到。&lt;/p>&lt;/blockquote>
&lt;p>確認沒問題後，執行以下指令來安裝 RHCOS，並設定為 Bootstrap 節點:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ curl http://192.168.101.9:8080/ignition/coreos-install.sh --output coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ chmod u+x coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安裝完成後&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ lsblk -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>安裝沒問題後，重新啟動機器，並將 CD-ROM 移除。&lt;/p>&lt;/blockquote>
&lt;p>Bootstrap 開啟完成後，回到 &lt;code>bastion&lt;/code> 節點執行以下指令來檢查部署狀況:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ openshift-install wait-for bootstrap-complete --dir&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/ignition --log-level debug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG OpenShift Installer 4.8.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Built from commit a5ddd2dd6c72d8a5ea0a5f17acd8b964b6a3d1be
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Waiting up to 20m0s &lt;span class="k">for&lt;/span> the Kubernetes API at https://api.lab.yiylin.internal:6443...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO API v1.21.1+051ac4f up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Waiting up to 30m0s &lt;span class="k">for&lt;/span> bootstrapping to complete...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 確認 openshift-api-server 以及 machine-config-server LB 可以通&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ curl -k https://api-int.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>:6443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ curl -k https://api-int.&lt;span class="si">${&lt;/span>&lt;span class="nv">DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>:22623/config/master &lt;span class="p">|&lt;/span> jq .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>當看到此訊息時，就能並往下進行安裝 Masters。若等待過久，可以透過 bastion 進入 bootstrap 節點查看狀況:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ssh core@bootstrap.lab.yiylin.internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">core $ sudo crictl pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">core $ sudo crictl ps -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">core $ sudo journalctl -b -f -u bootkube.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>正常情況 Pods 要如以下:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">POD ID CREATED STATE NAME NAMESPACE ATTEMPT RUNTIME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">8101e41b16f9e 52 seconds ago Ready bootstrap-kube-scheduler-localhost kube-system 0 (default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">907d0a933771a 52 seconds ago Ready bootstrap-kube-controller-manager-localhost kube-system 0 (default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">a8b709f7caeaa 52 seconds ago Ready bootstrap-kube-apiserver-localhost kube-system 0 (default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4eb793b3d1844 52 seconds ago Ready cloud-credential-operator-localhost openshift-cloud-credential-operator 0 (default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49a1cdb2b25f9 52 seconds ago Ready bootstrap-cluster-version-operator-localhost openshift-cluster-version 0 (default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c5098e42b5aa5 About a minute ago Ready bootstrap-machine-config-operator-localhost default 0 (default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">e7a3dbc6e0bc0 About a minute ago Ready etcd-bootstrap-member-localhost openshift-etcd 0 (default)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="maters">Maters
&lt;/h2>&lt;p>透過 vCenter 建立 Master 節點，並掛載 RHCOS Live ISO，並進入 Console 執行以下操作。&lt;/p>
&lt;p>首先進入系統後，先設定 Network 資訊:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ sudo nmtui
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;gt; 網路參考 Bootstrap 設定流程。&lt;/p>
&lt;p>確認沒問題後，執行以下指令來安裝 RHCOS，並設定為 Masters 節點:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ curl http://192.168.101.9:8080/ignition/coreos-install.sh --output coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ chmod u+x coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">IGNITION_FILE&lt;/span>&lt;span class="o">=&lt;/span>master.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安裝完後&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>安裝沒問題後，重新啟動機器，並將 CD-ROM 移除。&lt;/p>&lt;/blockquote>
&lt;p>Masters 都開啟完成後，回到 &lt;code>bastion&lt;/code> 節點執行以下指令來檢查部署狀況:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ openshift-install wait-for bootstrap-complete --dir&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/ignition --log-level debug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Waiting up to 30m0s &lt;span class="k">for&lt;/span> bootstrapping to complete...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Bootstrap status: &lt;span class="nb">complete&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO It is now safe to remove the bootstrap resources
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Time elapsed: 0s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 &lt;code>bastion&lt;/code> 執行以下指令來查看叢集狀況:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cp &lt;span class="nv">$HOME&lt;/span>/ocp4/ignition/auth/kubeconfig &lt;span class="nv">$HOME&lt;/span>/ocp4/kubeconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/kubeconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get csr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME AGE SIGNERNAME REQUESTOR CONDITION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-9xqqd 25m kubernetes.io/kubelet-serving system:node:etcd-1 Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-gzvwr 27m kubernetes.io/kubelet-serving system:node:etcd-0 Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-j6npt 25m kubernetes.io/kubelet-serving system:node:etcd-2 Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-mxqkf 25m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-tth9f 28m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csr-zx9q8 25m kubernetes.io/kube-apiserver-client-kubelet system:serviceaccount:openshift-machine-config-operator:node-bootstrapper Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system:openshift:openshift-authenticator 25m kubernetes.io/kube-apiserver-client system:serviceaccount:openshift-authentication-operator:authentication-operator Approved,Issued
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-1.lab.yiylin.internal Ready master 31m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-2.lab.yiylin.internal Ready master 15m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-3.lab.yiylin.internal Ready master 10m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完成後，即可進行 Workers 與 Infras 部署，並移除 Bootstrap。若等待過久，可以透過 bastion 進入 masters 節點查看狀況:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ssh core@maste-1.lab.yiylin.internal
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="workers-amp-infras">Workers &amp;amp; Infras
&lt;/h2>&lt;p>透過 vCenter 建立 Workers &amp;amp; Infras 節點，並掛載 RHCOS Live ISO，並進入 Console 執行以下操作。&lt;/p>
&lt;p>首先進入系統後，先設定 Network 資訊:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ sudo nmtui
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>網路參考 Bootstrap 設定流程。&lt;/p>&lt;/blockquote>
&lt;p>確認沒問題後，執行以下指令來安裝 RHCOS，並設定為 Workers &amp;amp; Infras 節點:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ curl http://192.168.101.9:8080/ignition/coreos-install.sh --output coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ chmod u+x coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">IGNITION_FILE&lt;/span>&lt;span class="o">=&lt;/span>worker.ign
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ./coreos-install.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安裝完成後&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ lsblk -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>安裝沒問題後，重新啟動機器，並將 CD-ROM 移除。&lt;/p>&lt;/blockquote>
&lt;p>Workers &amp;amp; Infras 都開啟完成後，就可以回到 &lt;code>bastion&lt;/code> 節點執行以下指令來檢查部署狀況:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ openshift-install wait-for install-complete --dir&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/ignition --log-level debug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG OpenShift Installer 4.8.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Built from commit a5ddd2dd6c72d8a5ea0a5f17acd8b964b6a3d1be
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Install Config...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading SSH Key...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Base Domain...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Platform...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Cluster Name...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Base Domain...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Platform...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Networking...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Platform...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Pull Secret...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Loading Platform...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Using Install Config loaded from state file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Waiting up to 40m0s &lt;span class="k">for&lt;/span> the cluster at https://api.lab.yiylin.internal:6443 to initialize...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEBUG Still waiting &lt;span class="k">for&lt;/span> the cluster to initialize: Some cluster operators are still updating: authentication, console, ingress, monitoring
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>出現 &lt;code>DEBUG&lt;/code> 即可往下操作，因為這部分會需要下載 Images 會比較久&lt;/p>&lt;/blockquote>
&lt;p>開啟一個新的 Terminal，在 &lt;code>bastion&lt;/code> 節點 Approve workers CSR:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/kubeconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get csr -ojson &lt;span class="p">|&lt;/span> jq -r .items&lt;span class="o">[]&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="k">select&lt;/span>&lt;span class="o">(&lt;/span>.status &lt;span class="o">==&lt;/span> &lt;span class="o">{}&lt;/span> &lt;span class="o">)&lt;/span> &lt;span class="p">|&lt;/span> .metadata.name &lt;span class="p">|&lt;/span> xargs oc adm certificate approve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 確認機器都起來&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra0 Ready worker 12m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra1 Ready worker 12m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra2 Ready worker 12m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master0 Ready master 11h v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1 Ready master 11h v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master2 Ready master 11h v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker0 Ready worker 12m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker1 Ready worker 12m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker2 Ready worker 12m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker3 Ready worker 12m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="搬移資源至-infra-nodes">搬移資源至 Infra nodes
&lt;/h3>&lt;p>接著要將 Worker 與 Infra 角色做拆分，確保系統與 Operator 服務不影響業務服務的負載，參考 &lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/machine_management/creating-infrastructure-machinesets.html#infrastructure-components_creating-infrastructure-machinesets" target="_blank" rel="noopener"
>Creating infrastructure machine sets&lt;/a>&lt;/p>
&lt;p>設定 infra nodes 的 labels:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ &lt;span class="k">for&lt;/span> i in &lt;span class="o">{&lt;/span>1..2&lt;span class="o">}&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> oc label node worker-&lt;span class="si">${&lt;/span>&lt;span class="nv">i&lt;/span>&lt;span class="si">}&lt;/span> node-role.kubernetes.io/app&lt;span class="o">=&lt;/span> --overwrite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ &lt;span class="k">for&lt;/span> i in &lt;span class="o">{&lt;/span>1..3&lt;span class="o">}&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> oc label node infra-&lt;span class="si">${&lt;/span>&lt;span class="nv">i&lt;/span>&lt;span class="si">}&lt;/span> node-role.kubernetes.io/infra&lt;span class="o">=&lt;/span> --overwrite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> oc label node infra-&lt;span class="si">${&lt;/span>&lt;span class="nv">i&lt;/span>&lt;span class="si">}&lt;/span> node-role.kubernetes.io/worker-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra-1.lab.yiylin.internal Ready infra 31m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra-2.lab.yiylin.internal Ready infra 31m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">infra-3.lab.yiylin.internal Ready infra 31m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-1.lab.yiylin.internal Ready master 156m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-2.lab.yiylin.internal Ready master 140m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-3.lab.yiylin.internal Ready master 135m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker-1.lab.yiylin.internal Ready app,worker 31m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker-2.lab.yiylin.internal Ready app,worker 31m v1.21.1+051ac4f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>編輯 &lt;code>Scheduler&lt;/code> 物件，並調整預設 &lt;code>NodeSelector&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc edit scheduler cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> defaultNodeSelector: node-role.kubernetes.io/app&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建立 Infra 機器的 Machine Config Pool 檔案:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat &lt;span class="p">&amp;amp;&lt;/span>lt&lt;span class="p">;&amp;amp;&lt;/span>lt&lt;span class="p">;&lt;/span>EOF &lt;span class="p">|&lt;/span> oc apply -f -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: machineconfiguration.openshift.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: MachineConfigPool
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> machineConfigSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchExpressions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - key: machineconfiguration.openshift.io/role
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> operator: In
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> values:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - infra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get mcp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>這時 Infra 節點會重新啟動。&lt;/p>&lt;/blockquote>
&lt;p>搬移 Router 元件至 Infra 節點上:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc edit IngressController default -n openshift-ingress-operator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodePlacement:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicas: &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc -n openshift-ingress get pod -o wide
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>搬移 Image Registry 元件至 Infra 節點上:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc edit configs.imageregistry.operator.openshift.io/cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc -n openshift-image-registry get pods -o wide
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>搬移 Monitoring 元件至 Infra 節點上:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat &amp;lt;&amp;lt; &lt;span class="s2">&amp;#34;EOF&amp;#34;&lt;/span> &amp;gt; oc apply -f -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: ConfigMap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: cluster-monitoring-config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: openshift-monitoring
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">data:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.yaml: &lt;span class="p">|&lt;/span>+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> alertmanagerMain:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prometheusK8s:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prometheusOperator:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> grafana:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> k8sPrometheusAdapter:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubeStateMetrics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> telemeterClient:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> openshiftStateMetrics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> thanosQuerier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/infra:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EOF
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ watch -n 0.1 oc -n openshift-monitoring get pod -o wide
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&amp;gt; 其他資源請參考 &lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/machine_management/creating-infrastructure-machinesets.html#infrastructure-moving-logging_creating-infrastructure-machinesets" target="_blank" rel="noopener"
>Moving OpenShift Logging resources&lt;/a> 搬移。&lt;/p>
&lt;p>叢集初始化會需要一點時間，完成後就可以透過 Console 查看整體狀況。&lt;/p>
&lt;h2 id="web-console">Web Console
&lt;/h2>&lt;p>透過 oc 取得 Web console 的 route URL:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ oc -n openshift-console get route console -o&lt;span class="o">=&lt;/span>&lt;span class="nv">jsonpath&lt;/span>&lt;span class="o">={&lt;/span>.spec.host&lt;span class="o">}{&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">console-openshift-console.apps.lab.yiylin.internal
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>取得 OpenShift 的 &lt;code>kubeadmin&lt;/code> 密碼:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ cat &lt;span class="nv">$HOME&lt;/span>/ocp4/ignition/auth/kubeadmin-password
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://i.imgur.com/7ykeVUc.png"
loading="lazy"
>&lt;/p>
&lt;hr>
&lt;h2 id="terminal-login">Terminal Login
&lt;/h2>&lt;p>開啟一個新的 Terminal，在 bastion 節點配置 &lt;code>KUBECONFIG&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HOME&lt;/span>/ocp4/kubeconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ oc get no
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="references">References
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/openshift/machine-config-operator/blob/master/docs/custom-pools.md" target="_blank" rel="noopener"
>https://github.com/openshift/machine-config-operator/blob/master/docs/custom-pools.md&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://gist.github.com/kairen/894348c6281f33a981b528e69c3d06bf" target="_blank" rel="noopener"
>https://gist.github.com/kairen/894348c6281f33a981b528e69c3d06bf&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/installing/installing_vsphere/installing-restricted-networks-vsphere.html" target="_blank" rel="noopener"
>https://docs.openshift.com/container-platform/4.8/installing/installing_vsphere/installing-restricted-networks-vsphere.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/sec-bind" target="_blank" rel="noopener"
>Networking Guide - BIND (Berkeley Internet Name Domain)&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.openshift.com/container-platform/4.8/installing/installing_bare_metal_ipi/ipi-install-prerequisites.html" target="_blank" rel="noopener"
>參考 IPI Prerequisites&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>